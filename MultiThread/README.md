# 쓰레드

```
클라이언트에서 요청이 들어오면 TCP/IP 커넥션 연결이 된다. 
그 후 서블릿을 호출을 해주는데 과연 누가 서블릿을 호출해줄까?
```

### 쓰레드
- 애플리케이션 코드를 순차적으로 실행
- 자바 메인 메서드를 처음 실행하면 main이라는 이름의 쓰레드가 실행

### 요청마다 쓰레드 생성
- 장점
1) 동시 요청을 처리할 수 있음
2) 리소스가 허용할 때까지 처리 가능
3) 하나의 쓰레드가 지연되어도 나머지 쓰레드는 정상 동작

- 단점
1) 쓰레드 생성 비용이 매우 비쌈
> 고객의 요청이 올 때마다 쓰레드를 생성하면 응답 속도가 늦어짐
2) 쓰레드는 컨텍스트 스위칭 비용이 발생
3) 쓰레드 생성에 제한이 없다.
> 고객 요청이 너무 많이 오면 CPU, 메모리 임계점을 넘어서 서버가 죽을 수 있음<br/>
> 그래서 WAS는 내부에 쓰레드 풀을 사용한다.

### 쓰레드 풀
- 필요한 쓰레드를 쓰레드 풀에 보관하고 관리
1) 쓰레드가 필요하면 이미 생성되어 있는 쓰레드를 쓰레드 풀에서 꺼내 사용
2) 사용을 종료하면 쓰레드 풀에 해당 쓰레드를 반납

만약 쓰레드가 모두 사용 중이라 쓰레드 풀에 쓰레드가 없다?<br/>
-> 기다리는 요청은 거절하거나 특정 숫자만큼만 대기하도록 설정할 수 있음

- 장점
1) 쓰레드가 미리 생성되어 있으므로 쓰레드를 생성하고 종료하는 비용이 절약
2) 응답 시간 빠름
3) 생성 가능한 쓰레드의 최대치가 있으므로 많은 요청이 들어와도 기존 요청은 안전하게 처리

- 쓰레드 풀 최대 쓰레드 튜닝
> 너무 낮게 설정 -> 동시 요청이 많으면 서버 리소스는 여유롭지만 클라이언트 응답 지연<br/>
> 너무 높게 설정 -> 동시 요청이 많으면 CPU, 메모리 리소스 임계점 초과로 서버 다운<br/>
> 장애 발생시? -> 클라우드면 일단 서버 늘리고 이후에 튜닝
